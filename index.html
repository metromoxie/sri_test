<!DOCTYPE html>
<meta charset=utf-8>
<title>Subresource Integrity</title>
<div id="log"></div>

<script>
  var loads_scripts_with_unknown_hash_function;
  var loads_scripts_with_matching_digest;
  var loads_scripts_with_multiple_digests_and_one_is_wrong;
  var loads_scripts_with_non_matching_digest;
  var loads_scripts_with_weak_digest_algorithms;
  var loads_scripts_with_base64_encoded_sha_digests;
  var loads_scripts_with_hyphenated_digest_name;
</script>

<!-- Should load even though the algorithm is unknown/weak, but potentially with a console error -->
<script src="loads-scripts-with-unknown-hash-function.js" integrity="sha1-CBPcM1CY0RCGLDEql4LRAtJb2bY="></script>

<!-- Should load -->
<script src="loads-scripts-with-matching-digest.js"
integrity="sha256-EKclUXH9SRRUv3FmL7bIEV0z2s3EvzHFxzHKCnfHT_E"></script>

<!-- Should load since at least one hash matches -->
<script src="loads-scripts-with-multiple-digests-and-one-is-wrong.js" integrity="sha256-LcuEvbYDG7SBUdWO/TInQDTrycVC4ovGo9/mBhDLx2s= sha512-deadbeef"></script>

<!-- Shouldn't load. Correct hash is sha256-mmx3g0H5KnIi_lnkuMJzYK7q6ss-Wnp-7zoGvgiQVtU -->
<script src="loads-scripts-with-non-matching-digest.js" integrity="sha256-EKclUXH9SRRUv3FmL7bIEV0z2s3EvzHFxzHKCnfHT_E"></script>

<!-- Should load -->
<script src="loads-scripts-with-base64-encoded-sha-digests.js" integrity="sha256-+xc7GxEqWw6VtSIsI5W90RQtOrfjeGD+6WFgxZgiuOw="></script>

<!-- Should load -->
<script src="loads-scripts-with-hyphenated-digest-name.js" integrity="sha-256-j83D7Rz6NSyzh/lT8Bowczi1ArdIRyKPia4Xi8nhIH4="></script>

<script>
  assert_true = function assert_true(value) {
    return value === true;
  }

  assert_undefined = function assert_undefined(value) {
    return value === undefined;
  }

  test = function test(assertionFunction, assertionText) {
    window.addEventListener("load", function(){
      var log = document.getElementById("log"),
          logLine = document.createElement("p"),
          passed = assertionFunction(),
          logMessage = assertionText + ": " + (passed ? "✓" : "✘");
      logLine.textContent = logMessage;
      log.appendChild(logLine);
    });
  }

  test(function() {
    return assert_true(loads_scripts_with_unknown_hash_function)
  }, "Loads scripts with unknown hash functions");

  test(function() {
    return assert_true(loads_scripts_with_matching_digest)
  }, "Loads scripts with matching digest");

  test(function() {
    return assert_true(loads_scripts_with_multiple_digests_and_one_is_wrong)
  }, "Loads scripts with multiple digests and one is wrong");

  test(function() {
    return assert_undefined(loads_scripts_with_non_matching_digest)
  }, "Doesn't load scripts with non-matching digest");

  test(function() {
    return assert_true(loads_scripts_with_base64_encoded_sha_digests)
  }, "Loads scripts with base64 encoded sha digests");

  test(function() {
    return assert_true(loads_scripts_with_hyphenated_digest_name)
  }, "Loads scripts with hyphenated digest names");
</script>
